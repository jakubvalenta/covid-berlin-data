#!/bin/bash

set -euo pipefail

dir=$1
keep_num=$2
find "$dir" -maxdepth 1 -type f -printf '%T@ %p\0' | \
    sort -zrn | \
    tail -z -n "+$((keep_num+1))" | \
    cut -z -d ' ' -f '2-' | \
    xargs -0 -n1 -I {} sh -c '[[ -n "{}" ]] && rm -v "{}"'
